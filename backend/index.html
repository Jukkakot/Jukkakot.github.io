<!DOCTYPE HTML>
<html>

<head>
	<script>
		window.onload = function () {
			getData()
		}
		function getData(type = "boardScore", avg = false) {
			let gameData
			axios.defaults.baseURL = 'http://localhost:3001';
			axios.get("/api/" + type, {
				params: {
					avg: avg
				}
			}).then(res => {
				gameData = res.data
				console.log(gameData)
			}).catch(err => {
				console.error("Error getting data", err)
			}).then(res => {
				if (gameData.type == "line") {
					drawLineChart(gameData, avg)
				} else if (gameData.type == "bar") {
					drawBarChart(gameData)
				} else if (gameData.type == "multibar") {
					drawMultiBarChart(gameData)
				}
			})
		}
		function drawLineChart(data, avg) {
			let gameData = data
			const dataPoints = gameData.data.map(game => {
				let defaultOptions = {
					type: avg ? "spline" : "line",
					// axisYType: "secondary",
					showInLegend: true,
					markerSize: 5,
					// yValueFormatString: "#####Ms",
				}
				return [{
					...defaultOptions,
					name: game.darkText,
					dataPoints: game.darkValues.map(move => {
						return { y: move.value, x: move.turnNumber }
					})
				},
				{
					...defaultOptions,
					name: game.lightText,
					dataPoints: game.lightValues.map(move => {
						return { y: move.value, x: move.turnNumber }
					})
				}]
			})

			var chart = new CanvasJS.Chart("chartContainer", {
				zoomEnabled: true,
				animationEnabled: true,
				theme: "dark2",
				toolTip: {
					content: "{name}: {x} , {y}",
					// shared: true
				},
				title: {
					text: gameData.title
				},
				axisX: {
					title: gameData.xTitle,
					crosshair: {
						enabled: true,
						snapToDataPoint: true
					}
				},
				axisY: {
					title: gameData.yTitle,
					// title:"joo",
					includeZero: true,
					crosshair: {
						enabled: true
					}
				},
				legend: {
					cursor: "pointer",
					verticalAlign: "top",
					horizontalAlign: "center",
					dockInsidePlotArea: true,
					itemclick: toogleDataSeries
				},
				data: dataPoints.flat()
			});
			chart.render();
			function toogleDataSeries(e) {
				if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
					e.dataSeries.visible = false;
				} else {
					e.dataSeries.visible = true;
				}
				chart.render();
			}
		}

		function drawBarChart(data) {
			let gameData = data
			var chart = new CanvasJS.Chart("chartContainer", {
				animationEnabled: true,
				theme: "dark2",
				axisY: {
					includeZero: true,
					interval: gameData.yInterval,
					title: gameData.yTitle
				},
				title: {
					text: gameData.title
				},
				data: [{
					type: "column",
					dataPoints: gameData.data.map((game, index) => {
						return { y: game.value, label: game.label + " " + game.gameCount + " games", color: game.color }
					})
				}]
			});
			chart.render();
		}
		// function drawMultiBarChart(data) {
		// 	let gameData = data
		// 	const dataPoints = gameData.data.map((game, index) => {
		// 		return {
		// 			type: "column",
		// 			label: game.label,
		// 			dataPoints: [
		// 				{ y: game.value, label: game.label, color: game.color },
		// 				// {x:gameData.data.indexOf(game), y: game.lightPlayer.value, label: game.lightPlayer.name, color: "#d1b496" }
		// 			]
		// 		}

		// 	})
		// 	console.log(dataPoints)

		// 	var chart = new CanvasJS.Chart("chartContainer", {
		// 		animationEnabled: true,
		// 		theme: "dark2",
		// 		title: {
		// 			text: gameData.title
		// 		},
		// 		axisY: {
		// 			title: gameData.yTitle,
		// 			includeZero: true,
		// 			interval: gameData.yInterval
		// 		},
		// 		data: dataPoints
		// 	});
		// 	chart.render();

		// 	function toolTipFormatter(e) {
		// 		var str = "";
		// 		var total = 0;
		// 		var str3;
		// 		var str2;
		// 		for (var i = 0; i < e.entries.length; i++) {
		// 			var str1 = "<span style= \"color:" + e.entries[i].dataSeries.color + "\">" + e.entries[i].dataSeries.name + "</span>: <strong>" + e.entries[i].dataPoint.y + "</strong> <br/>";
		// 			total = e.entries[i].dataPoint.y + total;
		// 			str = str.concat(str1);
		// 		}
		// 		str2 = "<strong>" + e.entries[0].dataPoint.label + "</strong> <br/>";
		// 		str3 = "<span style = \"color:Tomato\">Total: </span><strong>" + total + "</strong><br/>";
		// 		return (str2.concat(str)).concat(str3);
		// 	}

		// 	function toggleDataSeries(e) {
		// 		if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
		// 			e.dataSeries.visible = false;
		// 		}
		// 		else {
		// 			e.dataSeries.visible = true;
		// 		}
		// 		chart.render();
		// 	}

		// }
	</script>

</head>

<body>
	<button onClick="getData('boardScore')">Board score</button>
	<button onClick="getData('boardScore',true)">Avg Board score</button>
	<button onClick="getData('boardScoreCumulative',true)">Avg cumulative Board score</button>
	<button onClick="getData('turnTimes')">Turn times</button>
	<button onClick="getData('turnTimes',true)">Avg Turn times</button>
	<button onClick="getData('turnTimesCumulative')">Turn times cumulatives</button>
	<button onClick="getData('turnTimesCumulative',true)">Avg Turn times cumulatives</button>
	<button onClick="getData('chipcount')">Chip counts</button>
	<button onClick="getData('chipcount',true)">Avg Chip counts</button>
	<button onClick="getData('gameLength')">Game lengths</button>
	<button onClick="getData('winlose')">Win lose ratios</button>
	<div id="chartContainer"></div>

	<script src=" https://canvasjs.com/assets/script/canvasjs.min.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</body>

</html>