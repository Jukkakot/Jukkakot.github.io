<!DOCTYPE HTML>
<html>

<head>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script>
		window.onload = function () {
			axios.defaults.baseURL = 'http://localhost:3001';
			axios.get("/api/turntimesCumulative").then(res => {
				let gameData = res.data
				console.log(gameData)
				drawChart(gameData)
			}).catch(err => {
				console.error("Error getting data", err)
			})
		}
		
		function drawChart(data) {
			let gameData = data
			const dataPoints = gameData.data.map(game => {
					let defaultOptions = {
						type: "spline",
						axisYType: "secondary",
						showInLegend: true,
						markerSize: 0,
						yValueFormatString: "#####Ms",
					}
					return [{
						...defaultOptions,
						name: gameData.data.indexOf(game) +" Win " + game.winnerText,
						dataPoints: game.winnerTimes.map(move => {
							return { y: move.time, x: move.turnNumber }
						})
					},
					{
						...defaultOptions,
						name: gameData.data.indexOf(game) +" Opp " + game.oppPlayerText,
						dataPoints: game.oppPlayerTimes.map(move => {
							return { y: move.time, x: move.turnNumber }
						})
					}]
				})

				console.log(dataPoints)
				const chartData = []
				dataPoints.map(game => { return chartData.push(...game) })
				var chart = new CanvasJS.Chart("chartContainer", {
					animationEnabled: true,
					theme: "dark2",
					title: {
						text: gameData.title
					},
					toolTip: {
						shared: true
					},
					legend: {
						cursor: "pointer",
						verticalAlign: "top",
						horizontalAlign: "center",
						dockInsidePlotArea: true,
						itemclick: toogleDataSeries
					},
					data: chartData
				});


				function toogleDataSeries(e) {
					if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
						e.dataSeries.visible = false;
					} else {
						e.dataSeries.visible = true;
					}
					chart.render();
				}
				chart.render();
		}
	</script>
</head>

<body>
	<div id="chartContainer" style="height: 300px; width: 100%;"></div>
	<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>

</html>